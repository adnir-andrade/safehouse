Setting Up Your DNS and Certificate Authority (CA)
===================

Installation and Configuration Guide
-----------------

This guide will help you set up and configure various components needed for the "Cloud Development and Operations" project.
Before you start, be sure to install Multipass on your machine. You can follow these steps on your local environment, but they might (and will) destroy your machine.

DNS Setup - Installing
~~~~~~~~~~~~~~~~
This is what you need to install in order to make your DNS Server work

Update the Package List
^^^^^^^^^^^^^^^^

.. code-block:: console

   sudo apt-get update

We start by updating the list of available packages and their versions

Install BIND9
^^^^^^^^^^^^^^^^

.. code-block:: console

    sudo apt-get install bind9 -y

We then install BIND9, which is an open-source DNS server. We will be using, on this step and others, the -y flag to automatically answers "yes" to any prompts during the installation.

Install Systemctl
^^^^^^^^^^^^^^^^

.. code-block:: console

    sudo apt-get install systemctl -y

Then we proceed to install systemctl, a system and service manager for Linux operating systems.

Install DNS Utilities
^^^^^^^^^^^^^^^^

.. code-block:: console

    sudo apt-get install dnsutils -y

This command installs DNS utilities such as dig, nslookup, and others that are useful for querying DNS servers (in case we need to test things)

DNS Setup - Configuring
~~~~~~~~~~~~~~~~

We will now proceed to configure our DNS Server.

Edit BIND9 Options Configuration
^^^^^^^^^^^^^^^^

.. code-block:: console

    sudo nano /etc/bind/named.conf.options

We will use nano to open the BIND9 options configuration file. Your file must look like this:

.. code-block:: console
    options {
        directory "/var/cache/bind";

        dnssec-validation no;
        allow-query { 127.0.0.0/8; 10.193.231.0/24; };

        listen-on-v6 { };
    };

.. note::

   Replace `10.193.231.0/24` with the IP range generated by your Multipass setup. For instance, if your Multipass generated IPs in the `10.193.231.X` range, use that specific range.

Edit BIND9 Local Configuration
^^^^^^^^^^^^^^^^

.. code-block:: console

    sudo nano /etc/bind/named.conf.local

Open the BIND9 local configuration and leave it like this:

.. code-block:: console
    zone "myproblems.com" IN {
        type master;
        file "db.safehouse.com";
    };

Create DNS Zone File
^^^^^^^^^^^^^^^^

.. code-block:: console

    sudo nano /var/cache/bind/db.safehouse.com

This command creates a new file for your DNS zone. Here, you will define the DNS records for your domain safehouse.com.

.. code-block:: console
    $ORIGIN safehouse.com.
    $TTL 300;
    @ IN SOA dns youremailgoeshere.domain.com (1 30 30 30 30);
    @ IN NS dns
    dns IN A 10.193.231.233
    ca IN A 10.193.231.233
    gitlab IN A 10.193.231.42
    gitlab-runner IN A 10.193.231.210

.. note::

   This is the moment where you need to replace the IP addresses for `dns`, `ca`, `gitlab`, and `gitlab-runner` with the respective IPs of the VMs created for each environment. Ensure you use the IP addresses assigned by your Multipass setup.
   You can always come back here at a later moment - Just be sure to comment the line if you didn't create the VM yet.

=====================

---------------------

*********************

.....................

